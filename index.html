<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <title>Nikhil filmy | AI Movie Discovery</title>
    <link rel="icon"
        href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cdefs%3E%3ClinearGradient id='grad1' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2300c6ff;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%230072ff;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='url(%23grad1)' d='M448 32H64c-17.67 0-32 14.33-32 32v384c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32V64c0-17.67-14.33-32-32-32zM96 136c-13.25 0-24-10.75-24-24s10.75-24 24-24 24 10.75 24 24-10.75 24-24 24zm0 160c-13.25 0-24-10.75-24-24s10.75-24 24-24 24 10.75 24 24-10.75 24-24 24zm0 160c-13.25 0-24-10.75-24-24s10.75-24 24-24 24 10.75 24 24-10.75 24-24 24zM416 136c-13.25 0-24-10.75-24-24s10.75-24 24-24 24 10.75 24 24-10.75 24-24 24zm0 160c-13.25 0-24-10.75-24-24s10.75-24 24-24 24 10.75 24 24-10.75 24-24 24zm0 160c-13.25 0-24-10.75-24-24s10.75-24 24-24 24 10.75 24 24-10.75 24-24 24z'/%3E%3C/svg%3E"
        type="image/svg+xml">

    <style>
        html {
            scroll-behavior: smooth;
        }

        :root {
            --bg-dark: #0b0c10;
            --bg-card: #15161c;
            --brand-primary: #00c6ff;
            --brand-secondary: #0072ff;
            --brand-gradient: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --glass-bg: rgba(21, 22, 28, 0.85);
            --border-color: #2d3748;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--brand-primary);
        }


        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        main {
            flex: 1;
            width: 100%;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 5px;
            background: -webkit-linear-gradient(#00c6ff, #0072ff);
            width: 0;
            z-index: 9999;
            transition: width 0.2s ease-out;
        }

        header {
            text-align: center;
            padding: 3rem 1rem 1rem 1rem;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 800;
            letter-spacing: -2px;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        h4 {
            font-size: 1.2rem;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            color: var(--brand-primary);
            text-transform: uppercase;
            opacity: 0.9;
        }

        p.subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .search-wrapper {
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: row;
            gap: 15px;
            position: sticky;
            top: 5px;
            z-index: 100;
            -webkit-backdrop-filter: blur(16px);
            padding: 12px 20px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);

            background: rgb(21 22 28 / 81%);
            backdrop-filter: blur(4px);
        }

        .search-container {
            position: relative;
            flex: 2;
            display: flex;
            align-items: center;
        }

        #userPrompt {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            padding: 14px 15px;
            padding-right: 90px;
            font-size: 1.1rem;
            outline: none;
            resize: none;
            font-family: 'Outfit', sans-serif;
            line-height: 1.5;
            height: 55px;
            min-height: 55px;
            max-height: 120px;
            transition: height 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow-y: hidden;
        }

        #userPrompt:focus {
            overflow-y: auto;
        }

        #userPrompt::placeholder {
            color: #555;
        }

        .search-wrapper:focus {
            border-color: #0072ff;
            border: 2px solid #0072ff;
            box-shadow: none;
        }

        button#btnGo {
            position: absolute;
            right: 0;
            bottom: 0;
            top: 0;
            margin: auto;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--brand-gradient);
            color: #fff;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 198, 255, 0.3);
        }

        button#btnGo:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(0, 198, 255, 0.6);
        }

        button#btnGo:disabled {
            filter: grayscale(100%);
            cursor: not-allowed;
        }

        #btnClear {
            position: absolute;
            right: 55px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.1);
            color: #aaa;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #btnClear:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }


        .controls {
            display: none;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
            min-width: 220px;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding-left: 20px;
        }

        .custom-select {
            position: relative;
            width: 100%;
            cursor: pointer;
            font-size: 0.9rem;
            user-select: none;
        }

        .select-trigger {
            color: var(--text-muted);
            padding: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: color 0.3s;
        }

        .select-trigger:hover {
            color: #fff;
        }

        .select-options {
            position: absolute;
            top: 140%;
            right: 0;
            width: 240px;
            background: rgb(13 15 23 / 91%);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
            z-index: 200;
            backdrop-filter: blur(8px);
        }

        .select-options.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
            margin-top: 10px;
        }

        .option {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ccc;
        }

        .option:last-child {
            border-bottom: none;
        }

        .option:hover {
            background: rgba(0, 198, 255, 0.1);
            color: var(--brand-primary);
        }

        .option i {
            width: 20px;
            text-align: center;
            color: var(--brand-primary);
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 1200px;
            padding: 3rem 2rem;
            padding-top: 1rem !important;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            height: 320px;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid transparent;
            will-change: transform;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .floating-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--brand-gradient);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(0, 114, 255, 0.4);
            z-index: 99;
            color: #fff;
            font-size: 1.2rem;
            text-decoration: none;
            transition: transform 0.3s;
            opacity: 0;
            pointer-events: none;
        }

        .floating-button.visible {
            opacity: 1;
            pointer-events: all;
        }

        .floating-button:hover {
            transform: translateY(-5px);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 114, 255, 0.15);
            border-color: var(--brand-secondary);
        }

        .poster {
            height: 75%;
            background-color: #222;
            background-size: cover;
            background-position: center;
            width: 100%;
        }

        .info {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .title {
            font-weight: 700;
            font-size: 1rem;
            line-height: 1.3;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .rating {
            color: #f3bd00f0;
            font-weight: 600;
        }

        .rating i {
            color: #f3bd00f0;
            margin-right: 4px;
        }

        #status {
            margin-top: 2rem;
            font-family: monospace;
            color: var(--text-muted);
            height: 20px;
            display: none;
        }

        footer a {
            font-size: 0.8rem;
            color: #ddd !important;
            text-decoration-line: none;
        }

        footer a:hover {
            color: #0072ff !important;
        }

        footer {
            text-align: center;
            padding: 20px;
            width: 100%;
            border-top: 1px solid #333;
            background: #0f1014;
            font-size: 0.9rem;
            color: #666;
        }

        .nav-wrapper {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.9rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .nav-btn.active {
            background: rgba(0, 198, 255, 0.15);
            border-color: var(--brand-primary);
            color: #fff;
            box-shadow: 0 0 15px rgba(0, 198, 255, 0.2);
        }

        .nav-btn.active i {
            color: var(--brand-primary);
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0 40px 0;
            width: 100%;
        }

        .pagination-controls button {
            background: var(--bg-card);
            border: 1px solid #333;
            color: #fff;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination-controls button:hover:not(:disabled) {
            border-color: var(--brand-primary);
            color: var(--brand-primary);
        }

        .pagination-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #pageIndicator {
            font-weight: bold;
            color: var(--brand-primary);
        }


        @media (max-width: 768px) {

            header {
                padding: 2rem 1rem 1rem 1rem;
            }

            h1 {
                font-size: 2.2rem;
            }

            h4 {
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }

            p.subtitle {
                margin-bottom: 1rem;
                font-size: 0.8rem;
            }

            .search-wrapper {
                width: 92%;
                top: 10px;
                padding: 10px 15px;
                gap: 0;
            }

            .controls {
                display: none;
                border-left: none;
                padding-left: 10px;
                min-width: auto;
            }

            .controls>span {
                display: none;
            }

            .select-trigger {
                padding: 12px;
                justify-content: center;
            }

            #selectedText {
                display: none;
            }

            .select-trigger i {
                font-size: 1.2rem;
                color: var(--text-muted);
            }

            .select-options {
                width: 200px;
                right: -10px;
            }

            .movie-grid {
                padding: 1rem;
                gap: 1rem;
                grid-template-columns: repeat(2, 1fr);
            }

            .card {
                height: 260px;
            }

            #userPrompt {
                padding-right: 70px !important;
                font-size: 0.95rem;
                padding: 0px 5px;
            }

            button#btnGo {
                width: 35px;
                height: 35px;
            }

            #btnClear {
                right: 43px;
            }

            .nav-btn {
                padding: 8px 20px;
                font-size: 0.85rem;
            }
        }

        /* --- BROWSE PAGE LAYOUT --- */
        .browse-container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            margin: 20px auto;
            gap: 30px;
            padding: 0 20px;
            align-items: flex-start;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 260px;
            background: var(--bg-card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            flex-shrink: 0;
            position: sticky;
            top: 100px;
            /* Stick below header */
            max-height: 80vh;
            overflow-y: auto;
        }

        .sidebar h3 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .reset-btn {
            background: transparent;
            border: none;
            color: var(--brand-primary);
            cursor: pointer;
            font-size: 0.8rem;
        }

        .filter-group {
            margin-bottom: 20px;
        }

        .filter-group h4 {
            font-size: 0.95rem;
            margin-bottom: 10px;
            color: #ddd;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .filter-group select {
            width: 100%;
            padding: 8px;
            background: #0b0c10;
            color: #fff;
            border: 1px solid #333;
            border-radius: 6px;
            outline: none;
        }

        /* Genre Tags */
        .checkbox-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .genre-tag {
            background: #222;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            border: 1px solid #333;
            user-select: none;
        }

        .genre-tag.selected {
            background: var(--brand-gradient);
            color: #fff;
            border-color: transparent;
        }

        .browse-results {
            flex: 1;
            width: 100%;
        }

        #loadMoreBtn {
            display: block;
            margin: 20px auto;
            padding: 10px 30px;
            background: var(--bg-card);
            border: 1px solid var(--brand-primary);
            color: var(--brand-primary);
            border-radius: 30px;
            cursor: pointer;
        }

        #loadMoreBtn:hover {
            background: var(--brand-primary);
            color: #000;
        }

        .apply-mobile-btn {
            display: none;
        }

        /* Mobile Sidebar */
        @media (max-width: 768px) {
            .browse-container {
                flex-direction: column;
                padding: 0;
            }

            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                z-index: 50;
                display: none;
                /* Hidden initially, toggled via button */
            }

            .sidebar.active {
                display: block;
            }

            .apply-mobile-btn {
                display: block;
                width: 100%;
                margin-top: 20px;
                padding: 12px;
                background: var(--brand-gradient);
                border: none;
                color: #fff;
                border-radius: 8px;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="progress-bar"></div>
        <h1>
            <i class="fa-solid fa-film"
                style="background: -webkit-linear-gradient(#00c6ff, #0072ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i>
            Nikhil Filmy
        </h1>
        <h4>AI Powered Movie Recommendations</h4>
        <p class="subtitle">Describe a vibe, plot, or feeling. AI does the rest.</p>

        <div class="nav-wrapper">
            <button class="nav-btn active" onclick="switchTab('home')">
                <i class="fa-solid fa-fire"></i> Trending
            </button>
            <button class="nav-btn" onclick="switchTab('top-100')">
                <i class="fa-solid fa-fire"></i> Top 100
            </button>
            <button class="nav-btn" onclick="switchTab('search')">
                <i class="fa-solid fa-wand-magic-sparkles"></i> AI Search
            </button>
            <!-- <button class="nav-btn" onclick="switchTab('browse')">
                <i class="fa-solid fa-layer-group"></i> Browse All
            </button> -->
        </div>
    </header>

    <div class="search-wrapper" style="display: none;">
        <div class="search-container">

            <textarea id="userPrompt" rows="1" placeholder="e.g., 'Mind-bending sci-fi movies that are scary'"
                oninput="handleInput(this)" onfocus="handleInput(this)" onblur="shrinkInput(this)"></textarea>

            <button id="btnClear" onclick="clearSearch()" style="display: none;">
                <i class="fa-solid fa-xmark"></i>
            </button>

            <button id="btnGo" onclick="runLumina()">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </div>

        <div class="controls" id="sortControls">
            <span style="color:#666; font-size:0.9rem; font-weight: 600;">Sort</span>
            <div class="custom-select" id="customSelect">
                <div class="select-trigger" onclick="toggleDropdown()">
                    <span id="selectedText">‚ú® Relevance</span>
                    <i class="fa-solid fa-chevron-down" style="font-size: 0.8rem;"></i>
                </div>
                <div class="select-options">
                    <div class="option" onclick="selectOption('default', '‚ú® Relevance')"><i
                            class="fa-solid fa-wand-magic-sparkles"></i> Relevance</div>
                    <div class="option" onclick="selectOption('rating_high', '‚≠ê Rating: High to Low')"><i
                            class="fa-solid fa-arrow-up-9-1"></i> Rating: High to Low</div>
                    <div class="option" onclick="selectOption('rating_low', '‚≠ê Rating: Low to High')"><i
                            class="fa-solid fa-arrow-down-1-9"></i> Rating: Low to High</div>
                    <div class="option" onclick="selectOption('newest', 'üìÖ Release: Latest First')"><i
                            class="fa-regular fa-calendar-plus"></i> Release: Latest First</div>
                    <div class="option" onclick="selectOption('oldest', 'üìÖ Release: Oldest First')"><i
                            class="fa-regular fa-calendar-minus"></i> Release: Oldest First</div>
                </div>
            </div>
        </div>
    </div>


    <div id="browsePage" style="display: none;">
        <div class="browse-container">
            
            <aside class="sidebar" id="filterSidebar">
                <h3>Filters <button onclick="resetFilters()" class="reset-btn">Reset</button></h3>
                
                <div class="filter-group">
                    <h4>Type</h4>
                    <label><input type="radio" name="mediaType" value="movie" checked onchange="applyFilters()"> Movies</label>
                    <label><input type="radio" name="mediaType" value="tv" onchange="applyFilters()"> TV Shows</label>
                </div>

                <div class="filter-group">
                    <h4>Genres</h4>
                    <div id="genreList" class="checkbox-grid"></div>
                </div>

                <div class="filter-group">
                    <h4>Sort By</h4>
                    <select id="discoverSort" onchange="applyFilters()">
                        <option value="popularity.desc">Popularity Descending</option>
                        <option value="vote_average.desc">Rating Descending</option>
                        <option value="primary_release_date.desc">Newest First</option>
                    </select>
                </div>
                
                <button class="apply-mobile-btn" onclick="toggleSidebar()">Close Filters</button>
            </aside>

            <div class="browse-results">
                <button class="apply-mobile-btn" style="margin-bottom:10px;" onclick="toggleSidebar()">Open Filters</button>
                <div id="browseGrid" class="movie-grid"></div>
                <button id="loadMoreBtn" onclick="loadMoreBrowse()">Load More</button>
            </div>
        </div>
    </div>

    <div id="status"></div>

    <main id="movieGrid" class="movie-grid"></main>

    <div id="pagination" class="pagination-controls" style="display: none;">
        <button id="prevBtn" onclick="changePage(-1)" disabled>
            <i class="fa-solid fa-chevron-left"></i> Prev
        </button>
        <span id="pageIndicator">Page 1</span>
        <button id="nextBtn" onclick="changePage(1)">
            Next <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>

    <a href="#" class="floating-button" id="scrollTopBtn" title="Top" onclick="scrollToHome()">
        <i class="fa-solid fa-up-long"></i>
    </a>

    <footer>
        &copy; 2025 Developed by <a target="_blank" href="https://www.linkedin.com/in/sai-nikhil-898060175/"
            title="Connect with Me" style="font-weight: bold; color: #fff;">Sai Nikhil</a>
    </footer>

    <script>
        // API CONFIGURATION
        const MODEL_NAME = "gemini-2.5-flash-lite";
        const geminiKey = "AIzaSyCvtqhlBUSCSBbYvRUVXnh_zGxtec1miZ0";
        const tmdbKey = "b6ed0366df58af3c63fae705358f25c9";
        const statusDiv = document.getElementById('status');

        let currentPage = 1;
        let currentMode = 'home';

        let browsePageNum = 1;
        let selectedGenres = [];
        let fetchedMovies = [];
        let currentSort = 'default';
        let abortController = null;

        async function fetchGenres() {
            const type = document.querySelector('input[name="mediaType"]:checked').value;
            const url = `https://api.themoviedb.org/3/genre/${type}/list?api_key=${tmdbKey}&language=en-US`;
            const res = await fetch(url);
            const data = await res.json();

            const container = document.getElementById('genreList');
            container.innerHTML = '';
            data.genres.forEach(g => {
                const span = document.createElement('span');
                span.className = 'genre-tag';
                span.innerText = g.name;
                span.onclick = () => toggleGenre(g.id, span);
                container.appendChild(span);
            });
        }

        function toggleGenre(id, el) {
            el.classList.toggle('selected');
            if (selectedGenres.includes(id)) {
                selectedGenres = selectedGenres.filter(g => g !== id);
            } else {
                selectedGenres.push(id);
            }
            applyFilters(); 
        }

        async function applyFilters(isLoadMore = false) {
            if (!isLoadMore) {
                browsePageNum = 1;
                document.getElementById('browseGrid').innerHTML = '';
            }

            const type = document.querySelector('input[name="mediaType"]:checked').value;
            const sort = document.getElementById('discoverSort').value;
            const genreString = selectedGenres.join(',');

            const url = `https://api.themoviedb.org/3/discover/${type}?api_key=${tmdbKey}&language=en-US&sort_by=${sort}&with_genres=${genreString}&page=${browsePageNum}`;

            const res = await fetch(url);
            const data = await res.json();

            const grid = document.getElementById('browseGrid');
            data.results.forEach(item => {
                const title = item.title || item.name;
                const date = item.release_date || item.first_air_date || 'N/A';

                const card = document.createElement('div');
                card.className = 'card';
                const img = item.poster_path ? `https://image.tmdb.org/t/p/w300${item.poster_path}` : 'https://demofree.sirv.com/nope-not-here.jpg';
                card.onclick = () => window.open(`https://www.google.com/search?q=${encodeURIComponent(title + " " + type)}`, '_blank');

                card.innerHTML = `
                    <div class="poster" style="background-image: url('${img}')"></div>
                    <div class="info">
                        <div class="title">${title}</div>
                        <div class="meta">
                            <span class="rating">‚≠ê ${item.vote_average.toFixed(1)}</span>
                            <span>${date.split('-')[0]}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function loadMoreBrowse() {
            browsePageNum++;
            applyFilters(true);
        }

        window.onload = () => {
            switchTab('home');
        };

        function changePage(step) {
            if ((currentPage === 1 && step === -1) || (currentPage === 5 && step === 1)) return;

            currentPage += step;
            document.getElementById('pageIndicator').innerText = `Page ${currentPage}`;

            document.getElementById('prevBtn').disabled = (currentPage === 1);
            document.getElementById('nextBtn').disabled = (currentPage === 5);

            loadTopMovies(currentPage);
            scrollToHome();
        }

        // 'top_rated' to get the best 100 movies
        async function loadTopMovies(page) {
            const grid = document.getElementById('movieGrid');
            grid.innerHTML = '';
            fetchedMovies = [];
            setStatus(`Loading Top Movies (Page ${page})...`, "neutral");

            try {
                const url = `https://api.themoviedb.org/3/movie/top_rated?api_key=${tmdbKey}&language=en-US&page=${page}`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.results) {
                    for (const movie of data.results) {
                        fetchedMovies.push(movie);
                        createMovieCard(movie);
                        await new Promise(r => setTimeout(r, 50));
                    }
                    setStatus("", "neutral");
                }
            } catch (e) {
                setStatus("Error loading movies.", "error");
            }
        }

        
        function switchTab(mode) {
            currentMode = mode;
            const searchWrapper = document.querySelector('.search-wrapper');
            const pagination = document.getElementById('pagination');
            const navBtns = document.querySelectorAll('.nav-btn');
            const grid = document.getElementById('movieGrid');
            const browsePage = document.getElementById('browsePage');
            const status = document.getElementById('status');

            navBtns.forEach(btn => btn.classList.remove('active'));
            
            searchWrapper.style.display = 'none';
            pagination.style.display = 'none';
            browsePage.style.display = 'none';
            status.innerHTML = ''; 

            if (mode === 'browse') {
                navBtns[3].classList.add('active'); 
                grid.style.display = 'none';        
                browsePage.style.display = 'block';
                
                if (document.getElementById('browseGrid').innerHTML === "") {
                    fetchGenres();
                    applyFilters();
                }
            } 
            else if (mode === 'home') {
                navBtns[0].classList.add('active');
                grid.style.display = 'grid';       
                loadTrendingMovies();
            } 
            else if (mode === 'top-100') {
                navBtns[1].classList.add('active');
                grid.style.display = 'grid';       
                pagination.style.display = 'flex';

                currentPage = 1;
                document.getElementById('pageIndicator').innerText = "Page 1";
                document.getElementById('prevBtn').disabled = true;
                document.getElementById('nextBtn').disabled = false;
                loadTopMovies(1);
            } 
            else {
                navBtns[2].classList.add('active');
                grid.style.display = 'grid';       
                searchWrapper.style.display = 'flex';
                
                grid.innerHTML = ''; 
                fetchedMovies = [];
                setStatus("Ready to search.", "neutral");
                setTimeout(() => document.getElementById('userPrompt').focus(), 100);
            }
        }

        // 'top' to get the best 20 movies
        async function loadTrendingMovies() {
            const grid = document.getElementById('movieGrid');
            const controls = document.getElementById('sortControls');

            setStatus("Loading Top Movies...", "neutral");
            grid.innerHTML = '';
            fetchedMovies = [];

            try {
                const url = `https://api.themoviedb.org/3/trending/movie/week?api_key=${tmdbKey}&language=en-US`;
                const res = await fetch(url);
                const data = await res.json();

                if (data.results && data.results.length > 0) {
                    setStatus("", "neutral");

                    for (const movie of data.results) {
                        fetchedMovies.push(movie);
                        createMovieCard(movie);
                        await new Promise(r => setTimeout(r, 50));
                    }
                } else {
                    setStatus("Could not load trending movies.", "error");
                }

            } catch (e) {
                console.error(e);
                setStatus("Error connecting to TMDB.", "error");
            }
        }
        function toggleDropdown() {
            document.querySelector('.select-options').classList.toggle('open');
        }

        function selectOption(value, text) {
            document.getElementById('selectedText').innerHTML = text;
            document.querySelector('.select-options').classList.remove('open');
            currentSort = value;
            sortAndRender();
        }

        window.addEventListener('click', function (e) {
            if (!document.querySelector('.custom-select').contains(e.target)) {
                document.querySelector('.select-options').classList.remove('open');
            }
        });

        function scrollToHome() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shrinkInput(textarea) {
            textarea.style.height = '55px';
            textarea.scrollTop = 0;
        }

        let ticking = false;
        window.addEventListener('scroll', () => {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    const scrollTop = window.scrollY;
                    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                    const scrollPercent = (scrollTop / docHeight) * 100;
                    document.querySelector('.progress-bar').style.width = scrollPercent + '%';

                    const fab = document.getElementById('scrollTopBtn');
                    if (scrollTop > 400) fab.classList.add('visible');
                    else fab.classList.remove('visible');

                    ticking = false;
                });
                ticking = true;
            }
        });

        function setStatus(msg, type = "neutral") {
            statusDiv.innerText = msg;
            statusDiv.style.color = type === "error" ? "#ff5555" : type === "success" ? "#00f2ea" : "#888";
            statusDiv.style.display = msg ? "block" : "none";
        }

        async function runLumina() {
            const btn = document.getElementById('btnGo');
            const prompt = document.getElementById('userPrompt').value.trim();
            const textarea = document.getElementById('userPrompt');

            if (abortController) {
                abortController.abort();
                abortController = null;
                btn.innerHTML = '<i class="fa-solid fa-magnifying-glass"></i>';
                btn.style.background = "var(--brand-gradient)";
                setStatus("Search stopped.", "neutral");
                return;
            }
            if (!geminiKey) return setStatus("Ai API Key Error, Contact Developer.", "error");
            if (!prompt) return setStatus("Please enter a movie description.", "error");

            textarea.style.height = '55px';
            textarea.blur();

            abortController = new AbortController();
            const signal = abortController.signal;

            const grid = document.getElementById('movieGrid');
            const controls = document.getElementById('sortControls');

            btn.innerHTML = '<i class="fa-solid fa-circle-stop"></i>';
            btn.style.background = "#ff4b4b";
            setStatus("Searching the best for you...");
            grid.innerHTML = '';
            fetchedMovies = [];
            controls.style.display = 'none';

            try {
                // Fetch Movie Titles from Gemini
                const titles = await fetchGeminiRecommendations(prompt, geminiKey);

                if (!titles || titles.length === 0) {
                    setStatus("AI couldn't find any movies for that. Try a genre like 'Action' or 'Sci-Fi'.", "error");
                    return;
                }

                setStatus(`Found ${titles.length} matches. Loading visuals...`, "success");

                // Fetch Posters from TMDB
                for (let i = 0; i < titles.length; i++) {
                    if (!abortController) break;

                    let title = titles[i];
                    let movie = await fetchTMDBData(title, tmdbKey);

                    if (!movie) {
                        movie = {
                            title: title,
                            poster_path: "https://demofree.sirv.com/nope-not-here.jpg",
                            vote_average: null,
                            release_date: null,
                            id: `ghost-${Math.random().toString(36).substr(2, 9)}`
                        };
                    }

                    fetchedMovies.push(movie);
                    createMovieCard(movie, i);

                    if (i === 0) controls.style.display = 'flex';
                    await new Promise(r => setTimeout(r, 50));
                }

                if (abortController) setStatus("Ready.", "neutral");

            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error(error);
                    setStatus(error.message, "error");
                }
            } finally {
                if (abortController) {
                    btn.innerHTML = '<i class="fa-solid fa-magnifying-glass"></i>';
                    btn.style.background = "var(--brand-gradient)";
                    abortController = null;
                }
            }
        }

        function sortAndRender() {
            const grid = document.getElementById('movieGrid');
            if (fetchedMovies.length === 0) return;

            let sortedList = [...fetchedMovies];

            if (currentSort === 'rating_high') {
                sortedList.sort((a, b) => b.vote_average - a.vote_average);
            } else if (currentSort === 'rating_low') {
                sortedList.sort((a, b) => a.vote_average - b.vote_average);
            } else if (currentSort === 'newest') {
                sortedList.sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
            } else if (currentSort === 'oldest') {
                sortedList.sort((a, b) => new Date(a.release_date) - new Date(b.release_date));
            }

            grid.style.opacity = '0';
            setTimeout(() => {
                grid.innerHTML = '';
                grid.style.opacity = '1';
                sortedList.forEach((movie, index) => createMovieCard(movie, index));
                scrollToHome();
            }, 200);
        }

        async function fetchGeminiRecommendations(prompt, apiKey) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;

            const systemPrompt = `
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† You are a knowledgeable movie database expert with deep understanding of Global Cinema (including Indian Cinema - Tollywood, Bollywood, Kollywood).

¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† Analyze the specific mood, genre, theme, or era requested in User Query: "${prompt}"

¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† Guidelines for Accuracy:
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 1. Prioritize movies with high critical acclaim (Rotten Tomatoes/IMDb) or cult status.
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 2. Avoid TV shows, series, or shorts (Feature films only).
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 3. Ensure diversity in the list (mix of blockbusters, hidden gems).
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 4. Use the exact official English title to ensure database lookup success (e.g., use "Star Wars" not "Star Wars Episode IV").
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 5. If a specific actor/actress is mentioned (e.g., "Megastar"), ONLY list their movies.
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 6. If fewer than 50 relevant movies exist, return as many as possible without filler titles.
                7. Do NOT include any additional text, explanations, or formatting outside of the JSON array.
                8. Respond in English.
                9. Always include movies upto 2025 if they fit the criteria. this is very important.
                10. Avoid duplicates.
                11. Exclude remakes, reboots, or sequels unless specifically requested.
                12. Focus on original titles rather than translated or localized versions.
                13. Ensure the list is relevant to the user's query.
                14. Avoid overly obscure titles that lack sufficient information for database lookup.
                15. Do NOT include any non-movie entries.
                16. mainly include RECENT MOVIES from 2020, 2021, 2022, 2023, 2024 and 2025. But if the user specifically requests "Classics", "Old", "Vintage", or mentions a specific decade (e.g., "80s", "90s"), include relevant older movies as well.

                Important:
                1.You are a smart Movie Database Translator.
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 2. Always return the ORIGINAL English Title for Dubbed Movies.
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 3. If user asks for "Robo", you must return "Enthiran" (2010).
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 4. If user asks for "Robot", you must return "Enthiran".
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 5. If user asks for "7th Sense", you must return "7aum Arivu".
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 6. If user asks for "Yamudu", you must return "Singam".
                7. If user asks for "Hollywood movies dubbed in Telugu", return the ORIGINAL English Titles (e.g., "Transformers", "Avatar", "Iron Man").
                8. Do NOT write "Transformers Telugu". Just write "Transformers".
                9. If user asks for "Robo movies", only return movies featuring Robots.
                10. Prioritize Relevance over Quantity: Do NOT fill the list with random movies like "Baahubali" or "KGF" unless they strictly fit the genre requested.
              
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† Output Format:
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† Return ONLY a raw JSON Array of strings. 
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† No markdown. No extra text.
                OUTPUT ONLY A JSON ARRAY. NO TEXT BEFORE OR AFTER.
¬† ¬† ¬† ¬† ¬† ¬† ¬† ¬† 
                Example: ["Movie A", "Movie B, "Movie C", ... up to 50 titles]
¬† ¬† ¬† ¬† ¬† ¬† `;

            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: systemPrompt }] }] })
            });

            const data = await response.json();
            if (!response.ok) throw new Error(data.error?.message || "AI connection failed. please try again.");

            let text = data.candidates[0].content.parts[0].text;
            const jsonMatch = text.match(/\[[\s\S]*\]/);

            if (!jsonMatch) throw new Error("Something went wrong. Please try again.");

            try {
                return JSON.parse(jsonMatch[0]);
            } catch (e) {
                throw new Error("Failed to parse AI response.");
            }
        }

        async function fetchTMDBData(title, apiKey) {
            const url = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(title)}`;
            const res = await fetch(url);
            const data = await res.json();
            return data.results?.[0];
        }

        function createMovieCard(movie, index = 0) {
            const grid = document.getElementById('movieGrid');
            let posterUrl;
            if (movie.poster_path && movie.poster_path.startsWith('http')) {
                posterUrl = movie.poster_path;
            } else if (movie.poster_path) {
                posterUrl = `https://image.tmdb.org/t/p/w300${movie.poster_path}`;
            } else {
                posterUrl = "https://demofree.sirv.com/nope-not-here.jpg";
            }

            const year = movie.release_date ? movie.release_date.split('-')[0] : '-';

            let ratingDisplay;
            if (movie.vote_average && movie.vote_average > 0) {
                ratingDisplay = `<span class="rating"><i style="color: #f3bd00f0; font-size: 14.5px;" class="fa-solid fa-star"></i> ${movie.vote_average.toFixed(1)}</span>`;
            } else {
                ratingDisplay = `<span class="rating" style="color: #aaa;"><i style="color: #f3bd00f0; font-size: 14.5px;" class="fa-solid fa-star"></i> -</span>`;
            }

            const card = document.createElement('div');
            card.className = 'card';
            card.style.animationDelay = `${index * 50}ms`;

            // Search on click
            card.onclick = () => {
                window.open(`https://www.google.com/search?q=${encodeURIComponent(movie.title + " movie")}`, '_blank');
            };

            card.innerHTML = `
                <div class="poster" style="background-image: url('${posterUrl}')"></div>
                <div class="info">
                    <div class="title">${movie.title}</div>
                    <div class="meta">
                        ${ratingDisplay}
                        <span>${year}</span>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        }

        function handleInput(textarea) {
            const clearBtn = document.getElementById('btnClear');
            textarea.style.height = 'auto';

            if (textarea.value === '') {
                textarea.style.height = '55px';
            } else {
                textarea.style.height = textarea.scrollHeight + 'px';
            }

            if (textarea.value.trim().length > 0) {
                clearBtn.style.display = 'flex';
            } else {
                clearBtn.style.display = 'none';
            }
        }

        function clearSearch() {
            const textarea = document.getElementById('userPrompt');
            textarea.value = '';
            textarea.style.height = '55px';
            textarea.focus();
            document.getElementById('btnClear').style.display = 'none';
        }

    </script>
</body>

</html>
